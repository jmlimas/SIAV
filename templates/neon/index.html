<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta name="description" content="Neon Admin Panel" />
	<meta name="author" content="" />
	<link rel="shortcut icon" href="/static/img/favicon.ico" />

	<title>SIAV {% if avaluo.FolioK %} {{avaluo.FolioK}} {%endif%} {% if conteo_eventos_usuario > 0 %} ({{conteo_eventos_usuario}}) {% endif %}</title>

	<link rel="stylesheet" href="{{ STATIC_URL }}/assets/js/jquery-ui/css/no-theme/jquery-ui-1.10.3.custom.min.css">
	<link rel="stylesheet" href="{{ STATIC_URL }}/assets/css/font-icons/entypo/css/entypo.css">
	<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Noto+Sans:400,700,400italic">
	<link rel="stylesheet" href="{{ STATIC_URL }}/assets/css/bootstrap.css">
	<link rel="stylesheet" href="{{ STATIC_URL }}/assets/css/neon-core.css">
	<link rel="stylesheet" href="{{ STATIC_URL }}/assets/css/neon-theme.css">
	<link rel="stylesheet" href="{{ STATIC_URL }}/assets/css/neon-forms.css">
	<link rel="stylesheet" href="{{ STATIC_URL }}/assets/css/custom.css">
	<script type="text/javascript" language="javascript" src="{{ STATIC_URL }}JS/jquery-2.1.3.min.js"></script>
	<style>@import "{{ STATIC_URL }}CSS/sweet-alert.css";@import "{{ STATIC_URL }}CSS/Style.css";</style>
	<script>$.noConflict();</script>
	{% block style %}
	{% endblock %}
</head>
<body class="page-body  page-fade">

<div id="main-page-container" class="page-container sidebar-collapsed"><!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->
	
	<div class="sidebar-menu">

		<div class="sidebar-menu-inner">
			
			<header class="logo-env">

				<!-- logo -->
				<div class="logo">
					<a href="/SIAV/">
						<img src="{{ STATIC_URL }}/CSS/images/SIAV_logo.png" width="120" alt="" />
					</a>
				</div>

				<!-- logo collapse icon -->
				<div class="sidebar-collapse">
					<a href="#" class="sidebar-collapse-icon"><!-- add class "with-animation" if you want sidebar to have animation during expanding/collapsing transition -->
						<i class="entypo-menu"></i>
					</a>
				</div>

								
				<!-- open/close menu icon (do not remove if you want to enable menu on mobile devices) -->
				<div class="sidebar-mobile-menu visible-xs">
					<a href="#" class="with-animation"><!-- add class "with-animation" to support animation -->
						<i class="entypo-menu"></i>
					</a>
				</div>

			</header>
			
									
			<ul id="main-menu" class="main-menu">
				<li class="{% block alta %}{% endblock %}">
					<a href="/SIAV/alta_avaluo">
						<i class="glyphicon glyphicon-chevron-down"></i>
						<span class="title">Alta</span>
					</a>
				</li>
				<li class="{% block visita %}{% endblock %}">
					<a href="/SIAV/visita">
						<i class="glyphicon glyphicon-camera"></i>
						<span class="title">Visita</span>
						<span class="badge badge-secondary">{{por_visitar}}</span>
					</a>
				</li>
				<li class="{% block captura %}{% endblock %}">
					<a href="/SIAV/captura">
						<i class="glyphicon glyphicon-home"></i>
						<span class="title">Captura</span>
						<span class="badge badge-secondary">{{por_capturar}}</span>
					</a>
				</li>
				<li class="{% block salida %}{% endblock %}">
					<a href="/SIAV/salida">
						<i class="entypo-check"></i>
						<span class="title">Salida</span>
						<span class="badge badge-secondary">{{por_salida}}</span>
					</a>
				</li>
				<li class="{% block consulta %}{% endblock %}">
					<a href="/SIAV/consulta_master">
						<i class="entypo-search"></i>
						<span class="title">Consulta</span>
					</a>
				</li>
				<li class="{% block calendario %}{% endblock %}">
					<a href="/SIAV/calendario">
						<i class="entypo-calendar"></i>
						<span class="title">Calendario</span>
					</a>
				</li>
				<li class="{% block ficha %}{% endblock %}">
					<a href="/SIAV/ficha/986">
						<i class="entypo-star"></i>
						<span class="title">Fichas Técnicas</span>
					</a>
				</li>
				{% if user.is_staff %}
				<li class="{% block facturar %}{% endblock %}">
					<a href="/SIAV/facturar">
						<i class="glyphicon glyphicon-list-alt"></i>
						<span class="title">Facturar</span>
					</a>
				</li>
				<li class="{% block liquidar %}{% endblock %}">
					<a href="/SIAV/liquidar">
						<i class="glyphicon glyphicon-usd"></i>
						<span class="title">Liquidar</span>
					</a>
				</li>
				<li class="{% block estadistico %}{% endblock %}">
					<a href="/SIAV/estadistico/{%now "Y"%}/{%now "m"%}">
						<i class="entypo-chart-bar"></i>
						<span class="title">Estadístico</span>
					</a>
				</li>
				{% endif %}
		</ul>
			
		</div>

	</div>

	<div class="main-content">
				
		<div class="row">
		
			<!-- Profile Info and Notifications -->
			<div class="col-md-6 col-sm-8 clearfix">
		
				<ul class="user-info pull-left pull-none-xsm">
		
					<!-- Profile Info -->
					<li class="profile-info dropdown"><!-- add class "pull-right" if you want to place this from right -->
		
						<a href="#" class="dropdown-toggle" data-toggle="dropdown">
							<img src="{%if user.userprofile.picture %}{{user.userprofile.picture}}{% else %}{{ STATIC_URL }}/CSS/images/logo.png{% endif %}" alt="" class="img-circle" width="44" />
							{{user.first_name}} {{user.last_name}}
						</a>
		<!-- 
						<ul class="dropdown-menu">
		
							<li class="caret"></li>
		
							<li>
								<a href="extra-timeline.html">
									<i class="entypo-user"></i>
									Edit Profile
								</a>
							</li> 
		

		
							<li>
								<a href="extra-calendar.html">
									<i class="entypo-calendar"></i>
									Calendar
								</a>
							</li> -

						</ul>-->
					</li>
		
				</ul>  
				
				<ul class="user-info pull-left pull-right-xs pull-none-xsm">
		
					<!-- Raw Notifications -->
					<li id="notif_btn" class="notifications dropdown">
		
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
							<i id="notif_link" class="entypo-globe"></i>
							{% if conteo_eventos_usuario > 0 %} 
							<span class="badge badge-danger">{{conteo_eventos_usuario}}</span>
							{%endif%}
						</a>
					<ul id="notif_dd" class="dropdown-menu">
					</ul>
					</li>

					<li id="toler_btn" class="notifications dropdown">
		
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
							<i id="toler_link" class="entypo-clock"></i>
						</a>
					<ul id="toler_dd" class="dropdown-menu">
					</ul>

					</li>
					<li id="proc_btn" class="notifications dropdown">
		
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
							<i id="proc_link" class="entypo-eye"></i>
						</a>
					<ul id="proc_dd" class="dropdown-menu">
					</ul>

					</li>		
				</ul>
		
			</div>
		
		
			<!-- Raw Links -->
			<div class="col-md-6 col-sm-4 clearfix hidden-xs">
		
				<ul class="list-inline links-list pull-right">
		

		
					<li class="sep"></li>
		
					
					<li>
						<a href="#" data-toggle="chat" data-collapse-sidebar="1">
							<i class="entypo-chat"></i>
							Chat
							<span class="badge badge-success chat-notifications-badge is-hidden">0</span>
						</a>
					</li>
		
					<li class="sep"></li>
           <li>
                <a onclick="printDiv('printableArea')" href="#"> <i class="glyphicon glyphicon-print"></i>
                </a>
            </li>
            <li class="sep"></li>
            {% if user.is_staff %}
            <li>
                <a href="/SIAV/admin">Admin <i class="glyphicon glyphicon-wrench"></i>
                </a>
            </li>
            {% endif %}		
            <li class="sep"></li>
					<li>
						<a href="/SIAV/logout">
							Log Out <i class="entypo-logout right"></i>
						</a>
					</li>
				</ul>
		
			</div>
		
		</div>
		
		<hr />
		
{% block content %}
{% endblock %}
		
		<!-- Footer -->
		<footer class="main">
			
			&copy; 2015 <strong>SIAV 3.0</strong> by <a href="http://alluxi.mx" target="_blank">Alluxi</a>
		
		</footer>
	</div>

	
	<div id="chat" class="fixed" data-current-user="{{user.first_name}} {{user.last_name}}" data-order-by-status="1" data-max-chat-history="25">
	
		<div class="chat-inner">
	
	
			<h2 class="chat-header">
				<a href="#" class="chat-close"><i class="entypo-cancel"></i></a>
	
				<i class="entypo-users"></i>
				Chat
				<span class="badge badge-success is-hidden">0</span>
			</h2>
	
	
			<div class="chat-group" id="group-1">
				<strong>Favoritos</strong>
				{% for u in users %}
				<a href="#" id="{{u.id}}" data-conversation-history="#{{u.id}}-hist" class="chat_user"><span class="user-status is-online"></span> <em>{{u.first_name}} {{u.last_name}}</em></a>
				{% endfor %}
			</div>
	
	

	
		</div>

	
		<!-- conversation template -->
		<div class="chat-conversation">
	
			<div class="conversation-header">
				<a href="#" class="conversation-close"><i class="entypo-cancel"></i></a>
	
				<span class="user-status"></span>
				<span class="display-name"></span>
				<small></small>
			</div>
	
			<ul class="conversation-body">
			</ul>
	
			<div class="chat-textarea">
				<textarea class="form-control autogrow" placeholder="Type your message"></textarea>
			</div>
	
		</div>
	
	</div>
	

	
	
	<!-- Chat Histories -->

  {% for key, values in comments_by_user.items %}
    <ul class="chat-history" id="{{key}}-hist">
        {% for val in values%}  
        	<!-- val.3 - Boolean Leido , val.4  - Boolean Propio -->
        	<li class="opponent {% if val.3 or val.4 %}read{%else%}unread{% endif %}">
        	{% for v in val %}
        		{%if forloop.counter = 1 %}
        		<span class="user">{{v}}</span>
        		{% elif forloop.counter = 2 %}
        		<p>{{v}}</p>
        		{% elif forloop.counter = 3 %}
        		<span class="time">{{v}}</span>
        		{%endif%}
        	{% endfor %}
        	</li>
        {% endfor %}
    </ul>
    {% endfor %}


	
	<!-- Chat Histories 
<!-- 
	<ul class="chat-history" id="sample_history_2">
		<li class="opponent unread">
			<span class="user">Daniel A. Pena</span>
			<p>I am going out.</p>
			<span class="time">08:21</span>
		</li>
	
		<li class="opponent unread">
			<span class="user">Daniel A. Pena</span>
			<p>Call me when you see this message.</p>
			<span class="time">08:27</span>
		</li>
	</ul>
-->
	
</div>

	<!-- Imported styles on this page -->
	<!-- Bottom scripts (common) -->
	<script src="{{ STATIC_URL }}/assets/js/gsap/main-gsap.js"></script>
	<script type="text/javascript" language="javascript" src="{{ STATIC_URL }}JS/jquery-ui-1.8.24.custom.min.js"></script>
	<script type="text/javascript" language="javascript" src="{{ STATIC_URL }}JS/jquery-datepicker-es.js"></script>
	<script src="{{ STATIC_URL }}/assets/js/bootstrap.js"></script>
	<!--  <script src="{{ STATIC_URL }}/assets/js/joinable.js"></script> -->
	<script src="{{ STATIC_URL }}/assets/js/resizeable.js"></script> 
	<script src="{{ STATIC_URL }}/assets/js/neon-api.js"></script>

	<!-- Imported scripts on this page -->
	<script src="{{ STATIC_URL }}/assets/js/toastr.js"></script>

	<script type="text/javascript" language="javascript" src="{{ STATIC_URL }}JS/sweet-alert.min.js"></script>
	<script type="text/javascript" language="javascript" src="{{ STATIC_URL }}JS/autoNumeric.js"></script>
	<script type="text/javascript" language="javascript" src="{{ STATIC_URL }}JS/jquery.cookie.js"></script> 
	<script type="text/javascript" language="javascript" src="{{ STATIC_URL }}JS/socket.io.js"></script>


	<script>

    jQuery( document ).on( 'focus', ':input', function(){
        jQuery( this ).attr( 'autocomplete', 'off' );
    });

	    jQuery('#notif_btn').click(function() {
        jQuery('#notif_dd').html('&nbsp;').load('/get_notificaciones');
    });

    	jQuery('#toler_btn').click(function() {
       jQuery('#toler_dd').html('&nbsp;').load('/get_tolerancia');
    });

     	jQuery('#proc_btn').click(function() {
       jQuery('#proc_dd').html('&nbsp;').load('/get_proceso');
    });

     	jQuery('.chat_user').click(function($) {

		jQuery.ajax({
		  url: "/chat_leido/"+this.id,
		  beforeSend: function( xhr ) {
		    xhr.overrideMimeType( "text/plain; charset=x-user-defined" );
		  }
		})
		  .done(function( data ) {
		    if ( console && console.log ) {
		      console.log( "Sample of data:", data.slice( 0, 100 ) );
		    }
		  });

     	});
	    </script>
<script type="text/javascript">
jQuery(document).ready(function() {

    jQuery('#id_Solicitud').datepicker({ autoSize: true });
    jQuery('#id_Visita').datepicker({ autoSize: true });
    jQuery('#id_Salida').datepicker({ autoSize: true });
    // Deprecated since Jquery 1.7
    // $(':input[type="text"]').live('focus', function() {
    //     $(this).attr('autocomplete', 'off');
    // });



    jQuery("input[type=submit],button[type=submit], #submit-id-submit").click(function(e) {
   	
        jQuery("input[type=text]").each(function() {
            this.value = this.value.toUpperCase();

            jQuery("input[type=text]").each(function() {
                var self = jQuery(this);
                try {
                    var v = self.autoNumeric('get');
                    self.autoNumeric('destroy');
                    self.val(v);
                    console.log(self.val(v));
                } catch (err) {
                    console.log("Not an autonumeric field: " + self.attr("name"));
                }
            });


        });


        jQuery("#id_Valor").autoNumeric('destroy');
        jQuery("#id_formset_sencilla-Valor").autoNumeric('destroy');

    });


    jQuery('#id_Valor').autoNumeric('init', {
        aSign: '$'
    });
    jQuery('#id_formset_sencilla-Valor').autoNumeric('init', {
        aSign: '$'
    });
    jQuery('#id_Gastos').autoNumeric('init', {
        aSign: '$'
    });
    jQuery('#id_Importe').autoNumeric('init', {
        aSign: '$'
    });


   var sidebar_left = jQuery.cookie('sidebar_left');
   if(sidebar_left == 'closed'){
    jQuery("#main-page-container").addClass("sidebar-collapsed");
   }else{
    jQuery("#main-page-container").removeClass("sidebar-collapsed");
   }

});

function printDiv(divName) {
    var divName = document.getElementById(divName);
    var printContents = divName.innerHTML;
    var originalContents = document.body.innerHTML;
    document.body.innerHTML = printContents;
    window.print();
    document.body.innerHTML = originalContents;
}


</script>
<script type="text/javascript">
var data = {{ users_json|safe }};  
var current_user_id = {{user.id}};
// Conexión a Socket.io

var socket = io.connect('{{ request.META.HTTP_HOST }}:4000', { query: "user_id={{user.id}}&sessionid={{request.session.session_key}}" });
	var opts = {
			"closeButton": true,
			"debug": false,
			"positionClass": "toast-top-right",
			"toastClass": "black",
			"onclick": null,
			"showDuration": "300",
			"hideDuration": "1000",
			"timeOut": "5000",
			"extendedTimeOut": "1000",
			"showEasing": "swing",
			"hideEasing": "linear",
			"showMethod": "fadeIn",
			"hideMethod": "fadeOut"
		};



// Recibe evento de proceso
socket.on('message_receive', function(message) {
	    console.log("Recibido");	
	    toastr.success(message,'', opts);	
	    jQuery('#noti_ind').html('&nbsp;').load('/notificaciones_ind')
	});

//Recibe evento de chat
socket.on('chat_receive', function(message) {
	var sender_name = message.send_user_first_name +" "+ message.send_user_last_name;
	    toastr.success(message.message,sender_name+" dice: ", opts);	
	    neonChat.pushMessage(message.send_user_id, message.message.replace( /<.*?>/g, '' ),sender_name , new Date(), true, true);
	    neonChat.renderMessages(message.send_user_id, false);
	});



</script>

	<!-- JavaScripts initializations and stuff -->
	<script src="{{ STATIC_URL }}/assets/js/neon-chat.js"></script>
	<script src="{{ STATIC_URL }}/assets/js/neon-custom.js"></script>


	{% block scripts %} {% endblock %}
</body>
</html>