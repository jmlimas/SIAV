{% extends "neon/index.html" %}
{% load crispy_forms_tags %} 
{% load dayssince %} 
{% load month_convert %} 
{% block estadistico %}active{% endblock %} 
{% load currency %} 
{% load elapsed %} 
{% load humanize %} 
{% block content %}
<style>
.highcharts-container{width:100% !important; height:100% !important;}
</style>
<script type="text/javascript" language="javascript" src="{{ STATIC_URL }}JS/highcharts.js"></script>
<script>

jQuery(function($) {


var pre_url = "/SIAV/estadistico_anio_js/?anio=" + {{anio}};
$.getScript(pre_url, function() {});

jQuery('input[name="anio_check"]').each(function($) {
    if ({{ anio }} == this.value) {
        jQuery(this).prop('checked', true);
    }
});

$(".anio").change(function() {
    check_anio = "";
    jQuery('input[name="anio_check"]:checked').each(function() {
        check_anio += (this.value + ",");
        console.log(check_anio);
    });
    var url = "/SIAV/estadistico_anio_js/?anio=" + check_anio;
    jQuery.getScript(url, function() {});
});

// jQuery(".mes").change(function() {
//     check_anio = "";
//     jQuery('input[name="mes_check"]:checked').each(function() {
//         check_mes += (this.value + ",");
//         console.log(check_mes);
//     });
//     var url = "/SIAV/estadistico_mes_js/?mes=" + check_mes;
//     jQuery.getScript(url, function() {});
// });
});
</script>

<script>
jQuery(document).ready(function($) {
    var chart;
    jQuery('#todos_container').highcharts({
        chart: {
            type: 'column',
            backgroundColor: '#FFFFFF',
            borderColor: '#D5D5D5',
            borderWidth: 0,
        },
        colors: [
            '#4572A7',
            '#AA4643',
            '#89A54E',
            '#80699B',
            '#3D96AE',
            '#DB843D',
            '#92A8CD',
            '#A47D7C',
            '#B5CA92'
        ],

        title: {
            text: 'Historial'
        },
        xAxis: {
            categories: [{% for anio in monto_todos_anios %} {%if anio.year %} 
            {{anio.year}}, {% endif %} {% endfor %}]
        },
        yAxis: {
            title: {
                text: 'Cantidad'
            }
        },
        series: [{
                name: 'Año',
                data: [{% for anio in monto_todos_anios %} {% if anio.year %} 
                {{anio.Total|default_if_none:"0"}}, {% endif %} {% endfor %}]
            },

            /*{
            name: 'John',
            data: [5, 7, 3]
        }*/
        ],
        tooltip: {
            pointFormat: '<b>${point.y:,.0f}<b/>',
            shared: false,
        },
    });

    jQuery('#pie_container').highcharts({
        chart: {
            type: 'column',
            // // Explicitly tell the width and height of a chart
            // width: 900,
            // height: 500,
        },
        colors: [
            '#7f7f7f',
            '#11388a',
            '#1aadce',
            '#1A53CE',
            '#8ca9e6',
            '#191919',
            '#7E0006',
            '#77a1e5',
            '#1AB7CE',

        ],
        title: {
            text: ''
        },
        xAxis: {
            categories: ['Ene', 'Feb', 'Mzo', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sept', 'Oct', 'Nov', 'Dic']
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Servicios'
            },
            stackLabels: {
                enabled: true,
                style: {
                    fontWeight: 'bold',
                    color: (Highcharts.theme && Highcharts.theme.textColor) || 'gray',
                },
                formatter: function() {
                    return '<b>$' + this.total.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,') + '</b><br/>'
                }

            }
        },
        legend: {
            align: 'right',
            x: -70,
            verticalAlign: 'top',
            y: 20,
            floating: true,
            backgroundColor: (Highcharts.theme && Highcharts.theme.background2) || 'white',
            borderColor: '#CCC',
            borderWidth: 0,
            shadow: false
        },
        tooltip: {
            formatter: function() {
                return '<b>' + this.x + '</b><br/>' +
                    this.series.name + ': $' + this.y.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
            }
        },
        plotOptions: {
            column: {
                stacking: 'normal',
                dataLabels: {
                    enabled: false,
                    color: (Highcharts.theme && Highcharts.theme.dataLabelsColor) || 'white',
                    style: {
                        textShadow: '0 0 3px black, 0 0 3px black'
                    },
                }
            }
        },
        series: [{% for a in cliente %} {
            name: '{{a.1}}',
                    data: [
                            {% for i in a|slice:"2:" %}
                                
                                {{i|default_if_none:"0"}},
                                
                            {% endfor %}
                        ],
        }, {% endfor %}],
    });

});
</script>		
		

		
		<div class="row">
		
			<div class="col-sm-12">
		
				<div class="row">
			<div class="col-sm-2">
				

			<div class="panel panel-default">
							<div class="panel-heading">
								<div class="panel-title">Años</div>
		
								<div class="panel-options">
									<a href="#sample-modal" data-toggle="modal" data-target="#sample-modal-dialog-1" class="bg"><i class="entypo-cog"></i></a>
									<a href="#" data-rel="collapse"><i class="entypo-down-open"></i></a>
									<a href="#" data-rel="reload"><i class="entypo-arrows-ccw"></i></a>
									<a href="#" data-rel="close"><i class="entypo-cancel"></i></a>
								</div>
							</div>
							<div class="panel-body">
								        {% for a in anios %}
            <label class="checkbox">
                <input type="checkbox" class="anio" name="anio_check" value="{{a.year}}" id="check_{{a.year}}">{{a.year}}</label>
        {%endfor%}
							</div>
						</div>



				
			</div>		
					<div class="col-sm-5">
		
						<div class="panel panel-default">
							<div class="panel-heading">
								<div class="panel-title">Asignación</div>
		
								<div class="panel-options">
									<a href="#sample-modal" data-toggle="modal" data-target="#sample-modal-dialog-1" class="bg"><i class="entypo-cog"></i></a>
									<a href="#" data-rel="collapse"><i class="entypo-down-open"></i></a>
									<a href="#" data-rel="reload"><i class="entypo-arrows-ccw"></i></a>
									<a href="#" data-rel="close"><i class="entypo-cancel"></i></a>
								</div>
							</div>
							<div class="panel-body">
								<center><div id="line_container"></div></center>
							</div>
						</div>
		
					</div>
		
					<div class="col-sm-5">
		
						<div class="panel panel-default">
							<div class="panel-heading">
								<div class="panel-title">Importes</div>
		
								<div class="panel-options">
									<a href="#sample-modal" data-toggle="modal" data-target="#sample-modal-dialog-1" class="bg"><i class="entypo-cog"></i></a>
									<a href="#" data-rel="collapse"><i class="entypo-down-open"></i></a>
									<a href="#" data-rel="reload"><i class="entypo-arrows-ccw"></i></a>
									<a href="#" data-rel="close"><i class="entypo-cancel"></i></a>
								</div>
							</div>
							<div class="panel-body">
								<div id="bar_container"></div>
							</div>
						</div>
		
					</div>
		
				</div>
		
		</div>
	</div>

        <div class="row">
            <div class="col-sm-12">
                <div class="row">
                    <div class="col-sm-2">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                            <div class="panel-title">Clientes</div>
        
                                <div class="panel-options">
                                    <a href="#sample-modal" data-toggle="modal" data-target="#sample-modal-dialog-1" class="bg"><i class="entypo-cog"></i></a>
                                    <a href="#" data-rel="collapse"><i class="entypo-down-open"></i></a>
                                    <a href="#" data-rel="reload"><i class="entypo-arrows-ccw"></i></a>
                                    <a href="#" data-rel="close"><i class="entypo-cancel"></i></a>
                                </div>
                                </div>
                                <div class="panel-body">
                                <table class="table table-hover" >
                                    {% for a in cliente %}
                                    <tr>
                                        <td>
                                            <a data-toggle="modal" href="/SIAV/estadistico_cliente_depto/{{anio}}/{{a.0}}/" data-target="#myModal{{a.0}}">{{a.1}}</a>
                                        </td>
                                    </tr>
                        <!-- Modal -->
                        <div >
                            <div class="modal" id="myModal{{a.0}}" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                <div class="modal-dialog ">
                                    <div class="modal-content"></div>
                                    <!-- /.modal-content --> </div>
                                <!-- /.modal-dialog --> </div>
                            <!-- /.modal --> </div>
                                    {% endfor %}
                                </table>
                            </div>
                        </div>
                    </div>
					<div class="col-sm-10">
						<div class="panel panel-default">
							<div class="panel-heading">
								<div class="panel-title">Importe mensual de servicios por cliente</div>
		
								<div class="panel-options">
									<a href="#sample-modal" data-toggle="modal" data-target="#sample-modal-dialog-1" class="bg"><i class="entypo-cog"></i></a>
									<a href="#" data-rel="collapse"><i class="entypo-down-open"></i></a>
									<a href="#" data-rel="reload"><i class="entypo-arrows-ccw"></i></a>
									<a href="#" data-rel="close"><i class="entypo-cancel"></i></a>
								</div>
							</div>
							<div class="panel-body">
								<div id="pie_container"></div>
							</div>
						</div>
					</div>
					</div>
			</div>
		</div>
		<div class="row">
			<div class="col-sm-12">
						<div class="panel panel-default">
							<div class="panel-heading">
								<div class="panel-title">Historial</div>
		
								<div class="panel-options">
									<a href="#sample-modal" data-toggle="modal" data-target="#sample-modal-dialog-1" class="bg"><i class="entypo-cog"></i></a>
									<a href="#" data-rel="collapse"><i class="entypo-down-open"></i></a>
									<a href="#" data-rel="reload"><i class="entypo-arrows-ccw"></i></a>
									<a href="#" data-rel="close"><i class="entypo-cancel"></i></a>
								</div>
							</div>
							<div class="panel-body">
								<div id="todos_container"></div>
							</div>
						</div>
			</div>
		</div>

{% endblock %}

{% block scripts %}
<script>
{% for a in cliente %}
jQuery("#myModal{{a.0}}").on('hidden.bs.modal', function($) {
    jQuery(this).data('bs.modal', null);
    jQuery(this).removeData('bs.modal');
});

{% endfor %}
</script>

	<script src="{{ STATIC_URL }}/assets/js/joinable.js"></script>
	<script src="{{ STATIC_URL }}/assets/js/resizeable.js"></script>

{% endblock %}

</body>
</html>