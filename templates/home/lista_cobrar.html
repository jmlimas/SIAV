{% extends "home/base.html" %}

{% load crispy_forms_tags %}

{% load dayssince %}

{% load currency %}



{% block script %}
 
    <script type="text/javascript" language="javascript" src="{{ STATIC_URL }}JS/picnet-table.js"></script>
    <script type="text/javascript" language="javascript" src="{{ STATIC_URL }}JS/jquery.livequery.js"></script> 

    <script type="text/javascript">
        $(document).ready(function () {
            $('#avaluos_table').tableFilter();
                valor = 0;

            var rowCount = { p: $('#avaluos_table tbody tr:visible').length };
            valor = ($('#avaluos_table tbody tr:visible').length);

            $('#cantidad_tabla').html(valor);
            
            $('#avaluos_table thead').on("change", function () {
                    setTimeout(function () {
                        window.location = '/SIAV/cobrar/';
                    }, 1000);
            });
    });

    </script>

 {% endblock %}      
{% block content %}

  <h1>Servicios por Cobrar</h1>
  <h2 style="text-align:left"><span id="cantidad_tabla"></span>   Servicios</h2>

  <table class="table table-hover">
  {%for x in agrupados %}
    <tr>
        <td style="width:10px;">
            {{x.Factura}}
        </td>
         <td style="width:10px;">
            {{x.Cliente}}
        </td>
		 <td style="width:10px;">
            {{x.Total|currency}}

		
    </tr>
  {% endfor %}
  		  <tr>
			  <td>
			  Total General:
			  </td>
			  <td>
			  {{total_general|currency}}
			  </td>
		  </tr>
  </table>

  <table id='avaluos_table'>
	  <thead>
		  <tr><th id="folio_type" filter-type="ddl" style="width:40px">Folio K</th><th style="width:150px" filter='false' >Ref.</th><th filter-type='ddl'>Cliente</th><th filter="false">Calle</th><th filter='false'>Ext.</th><th filter='false'>Int.</th><th style="width:100px" filter='false'>Factura</th><th style="width:100px" filter='false'>Pagado</th><th filter='false'>Municipio</th><th  filter='false'>Entrega</th><th filter='false'>Monto</th><th filter='false' class="tabla_opciones">Opciones</th></tr>
	  </thead>
	  <tbody>
          <form action="/SIAV/cobrar/" method="post">
              {{example_formset.management_form }}
		   {% for a,b in olist %}
              {{ b.id }}
		  <tr>
			  <td> {{a.FolioK}} </td>
		      <td> {{a.Referencia}} </td>
			  <td> {{a.Cliente}} </td>
		      <td> {{a.Calle}} </td>
			  <td style="width:3px;"> {{a.NumExt}} </td>
			  <td style="width:10px;"> {{a.NumInt}} </td>
              <td style="width:10px;"> {{a.Factura}} </td>
			  <td style="width:10px;"> {% crispy b %} </td>
		      <td> {{a.Municipio}} </td>
		      <td> {{a.Salida|date:"d/m/y"}} </td>
              <td> {{a.Importe|currency }}</td>			  
		      <td class="tabla_opciones"> <a href="/SIAV/consulta_master/{{a.avaluo_id}}">Editar</a></td>
		  </tr>
          {% endfor %}
        <input class='btn btn-primary' type="submit" name="submit" value="Cobrar" />

          </form>
	  </tbody>

  </table>


  
{% endblock %}
