{% extends "home/base.html" %}

{% load dayssince %}

{% load bootstrap3 %}

{% bootstrap_css %}
{% bootstrap_javascript %}

{% block visita %}active{% endblock %}

{% block script %}
<script type="text/javascript" language="javascript" src="{{ STATIC_URL }}JS/jquery.dataTables.js"></script>
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}CSS/bootstrap/css/dataTables.boostrap.css">
<script type="text/javascript" language="javascript" src="{{ STATIC_URL }}/JS/dataTables.tableTools.js"></script>
<script type="text/javascript" language="javascript" src="{{ STATIC_URL }}/JS/dataTables.bootstrap.js"></script>
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}CSS/smart-admin.css">

<script type="text/javascript">
$(document).ready(function () {
    var oTable = $('#avaluos_table').DataTable({
        "dom": '&t;"tof"T<"clear">i&gtlp;',
        "tableTools": {
            "sSwfPath": "{{ STATIC_URL }}swf/copy_csv_xls_pdf.swf"
        },
     }

      );

 $("#avaluos_table #thead_2 th").each( function ( i ) {
        var select = $('<select style="max-width:60px; ><option style="max-width:60px; value=""></option></select>')
            .appendTo( $(this).empty() )
            .on( 'change', function () {
                oTable.column( i )
                    .search( $(this).val() )
                    .draw();
            } );
            select.append( '<option value="'+" "+'" style="max-width:60px;">'+"---"+'</option>' )
           oTable.column( i ).data().unique().sort().each( function ( d, j ) {
            select.append( '<option value="'+d+'" style="max-width:60px;">'+d+'</option>' )

        } );



      } );      


  $('#id_Visita').datepicker({ autoSize: true , dateFormat: 'dd/mm/yy'});


$('#visita_masiva_button').click(function () {

    // Some code

    if($(".form-checkbox").is(':checked')) {

      var selected = [];
      $('input:checked').each(function() {
          selected.push($(this).parent().next().next().next().next().next().next().next().html());
      });
      var bandera = true;
      for ( var i = 0; i < selected.length; i++ ) {
          // Logs "try 0", "try 1", ..., "try 4".
          if(selected[0] != selected[i]){
              bandera = false;
              console.log( selected[i] );
              //console.log( bandera );
          }
      }

      if(bandera == false){
        alert("Todos los servicios deben pertenecer a la misma colonia.");
      }else{
        $('#visita_masiva').modal('show');
        console.log( selected.toString());
      }
      
      var selected = [];

       // $('#visita_masiva').modal('show');
    }else{
        alert("Selecciona al menos una casilla.");
    }

});

});





</script>
<style>
.modal-content {
  width: 900px;
  margin-left: -150px;
}
</style>
{% endblock %}      

{% block content %}

    {% if forma.errors %}
<p style="color: red;">Porfavor completa los campos faltantes.</p>
{% endif %}
<p>
  <a id="visita_masiva_button"  title="Visita" style="float:right" class="btn btn-success" role="button">
    <span class="glyphicon glyphicon-ok"></span>
    VISITAR
  </a>
</p>
<br>
<br>
<div class="caption"></div>
<div class="jarviswidget jarviswidget-color-darken jarviswidget-sortable" id="wid-id-0" data-widget-editbutton="false" role="widget">
    <div align="center">

<h1>Visita</h1>
</div>

<span class="jarviswidget-loader">
  <i class="fa fa-refresh fa-spin"></i>
</span>
<div role="content" id="table-my-content">

<div class="jarviswidget-editbox"></div>
<div id="dt_basic_wrapper" class="dataTables_wrapper form-inline" role="grid">
<div class="dt-wrapper">
  <div class="table-responsive ">
    <form id="modal-form" class="form-horizontal" method="post" action="/SIAV/visita_masiva/">

 <table id='avaluos_table' class="table table-hover">
    <thead>
      <tr>
        <th/>
        <th >Folio K</th>
        <th  >Ref.</th>
        <th >Cliente</th>
        <th>Calle</th>
        <th >Ext.</th>
        <th >Int.</th>
        <th >Colonia</th>
        <th >Municipio</th>
        <th >Prio.</th>
        <th >Estatus</th>
        <th>Dias</th>
        <th >Visita</th>
      </tr>
    </thead>
    <thead id="thead_2">
        <th ></th>
        <th class="sh">Cliente</th>
        <th class="sh">Calle</th>
        <th class="sh" >Ext.</th>
        <th class="sh" >Int.</th>
        <th class="sh" >Colonia</th>
        <th class="sh" >Municipio</th>
        <th class="sh" >Prio.</th>
        <th class="sh" >Estatus</th>
        <th class="sh">Dias</th>
        <th class="sh"></th>
        <th class="sh"></th>
        </thead>
<body>
    {% for a in avaluos %}
    <tr class="{% if a.Solicitud|dayssince|add:"0" > a.Depto.Tolerancia|add:"0" and a.Estatus != 'DETENIDO' %}danger{% endif%}">
      <td><input class="form-checkbox" type="checkbox" value="{{ a.avaluo_id }}" name="avaluo_visitado"></td>
      <td >{{a.FolioK}}</td>
      <td >{{a.Referencia}}</td>
      <td >{{a.Cliente}}</td>
      <td >{{a.Calle}}</td>
      <td >{{a.NumExt}}</td>
      <td >{{a.NumInt}}</td>
      <td >{{a.Colonia}}</td>
      <td >{{a.Municipio}}</td>
      <td >{{a.Prioridad}}</td>
      <td ><span class="label label-{%if a.Estatus = 'PROCESO'%}success{%elif a.Estatus = 'DETENIDO'%}default{%endif%}">{{a.Estatus}}</span></td>
      <td >{{ a.Solicitud|dayssince }}</td>
      <td >
        <a href="/SIAV/edita_visita/{{a.avaluo_id}}"><button type="button" class="btn btn-primary btn-sm">
  <span class="glyphicon glyphicon-edit"></span> </button></a>
      </td>
    </tr>
    {% endfor %}
</body>
  </table>
    </div>
  </div>
</div>
</div>
</div>

<div class="modal fade" id="visita_masiva">

<div class="modal-dialog">
t
<div class="modal-content">
  <div class="modal-body">

    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h2 style="text-align:center">Visita MÃºltiple</h2>
    <div class="modal-footer">
      <span style="display: block">
        {% if not visita_masiva.is_valid %}
        <div class='hide'>invalid_form</div>
        {% endif %}
          {% csrf_token %}
          {% bootstrap_form visita_masiva layout='horizontal'  %}
      </span>
    </div>
    <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
    <button type="submit" class="btn btn-success" id="enviar-masiva" style="float:right">Enviar</button>
  </form>
</div>
</div>
<!-- /.modal-content -->
</div>
<!-- /.modal-dialog -->

</div>
<!-- /.modal -->
{% endblock %}